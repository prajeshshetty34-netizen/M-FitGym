<!DOCTYPE html>
<html lang="en">
<head>
  <title>Calorie & Macro Recommendation</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
  <div id="header-placeholder"></div>
  <section class="calorie-section">
  <div class="calorie-wrapper">
    
    <!-- Left: Form -->
    <div class="calorie-container">
      <h1>üçé Calorie & Macro Recommendation</h1>
      <form id="calorieForm">
        <input type="number" id="age" placeholder="Age" required>
        <select id="gender" required>
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
        <input type="number" id="height" placeholder="Height in cm" required>
        <input type="number" id="weight" placeholder="Weight in kg" required>
        <select id="activity" required>
          <option value="">Activity Level</option>
          <option value="1.2">Sedentary</option>
          <option value="1.375">Light</option>
          <option value="1.55">Moderate</option>
          <option value="1.725">Active</option>
        </select>
        <button type="submit">Calculate</button>
      </form>
    </div>

    <!-- Right: Results + Chart -->
    <div class="result-container">
      <div id="calorieResult" class="result"></div>
      <div class="chart-box">
        <canvas id="macroChart"></canvas>
      </div>
    </div>

  </div>
</section>

  

<script>
  if (!localStorage.getItem("loggedIn")) {
    window.location.href = "login.html";
  }

  let macroChart;

  document.getElementById("calorieForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const age = parseInt(document.getElementById("age").value);
    const gender = document.getElementById("gender").value;
    const height = parseFloat(document.getElementById("height").value);
    const weight = parseFloat(document.getElementById("weight").value);
    const activity = parseFloat(document.getElementById("activity").value);

    let bmr;
    if (gender === "male") {
      bmr = 10 * weight + 6.25 * height - 5 * age + 5;
    } else {
      bmr = 10 * weight + 6.25 * height - 5 * age - 161;
    }

    const calories = Math.round(bmr * activity);

    // --- Macronutrient Breakdown ---
    const protein = Math.round(weight * 2); // 2g per kg bodyweight
    const proteinCalories = protein * 4;

    const fatCalories = Math.round(calories * 0.25); // 25% from fat
    const fat = Math.round(fatCalories / 9);

    const carbCalories = calories - (proteinCalories + fatCalories);
    const carbs = Math.round(carbCalories / 4);

    const proteinPct = Math.round((proteinCalories / calories) * 100);
    const fatPct = Math.round((fatCalories / calories) * 100);
    const carbPct = Math.round((carbCalories / calories) * 100);

    // Show Results
    document.getElementById("calorieResult").innerHTML = `
      <h3>Based on your inputs:</h3>
      <p>üî• Calories: <strong>${calories} kcal/day</strong></p>
      <p>ü•© Protein: <strong>${protein} g</strong> (${proteinPct}%)</p>
      <p>üçö Carbs: <strong>${carbs} g</strong> (${carbPct}%)</p>
      <p>ü•ë Fats: <strong>${fat} g</strong> (${fatPct}%)</p>
    `;

    // Draw Chart
    const ctx = document.getElementById("macroChart").getContext("2d");
    if (macroChart) {
      macroChart.destroy(); // prevent overlap
    }
    macroChart = new Chart(ctx, {
      type: "pie",
      data: {
        labels: ["Protein", "Carbs", "Fat"],
        datasets: [{
          data: [proteinCalories, carbCalories, fatCalories],
          backgroundColor: ["#2ecc71", "#3498db", "#e67e22"],
          borderWidth: 2,
          borderColor: "#fff"
        }]
      },
      options: {
        plugins: {
          legend: {
            position: "bottom",
            labels: { color: "#fff", font: { size: 14 } }
          }
        }
      }
    });
  });
</script>

<script src="js/calories.js"></script>
<script src="js/loadHeader.js"></script>

</body>
</html>
